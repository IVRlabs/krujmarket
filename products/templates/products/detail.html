{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <!-- Галерея изображений -->
        <div class="col-md-6">
            <div class="main-image mb-3">
                <img src="{{ product.main_image.url }}"
                     class="img-fluid rounded"
                     alt="{{ product.name }}"
                     id="mainProductImage">
            </div>
           
            <div class="thumbnail-container d-flex flex-wrap">
                {% for image in all_images %}
                <div class="thumbnail-item p-1">
                    <img src="{{ image.url }}"
                         class="img-thumbnail {% if forloop.first %}active{% endif %}"
                         alt="{{ product.name }}"
                         style="cursor: pointer; width: 80px;"
                         onclick="document.getElementById('mainProductImage').src = this.src">
                </div>
                {% endfor %}
            </div>
        </div>
       
        <!-- Информация о товаре -->
        <div class="col-md-6">
            <h1 class="product-title">{{ product.name }}</h1>
            <div class="price mb-3">
                <span class="h4 text-danger">{{ product.price }} руб.</span>
            </div>
           
            <div class="description mb-4">
                <h5>Описание:</h5>
                <p>{{ product.description }}</p>
            </div>
           
            <div class="actions">
                <button class="btn btn-primary btn-sm" onclick="addToCart({{ product.id }}, '{{ csrf_token }}')">
                    Добавить в корзину
                </button>
                <div id="cartMessage" class="mt-2 text-success" style="display:none;"></div>
            </div>
           
            {% if product.additional_images.exists %}
            <div class="mt-4">
                <h5>Другие изображения:</h5>
                <div class="row">
                    {% for image in product.additional_images.all %}
                    <div class="col-4 mb-3">
                        <img src="{{ image.image.url }}"
                             class="img-fluid rounded"
                             alt="{{ image.alt_text|default:product.name }}">
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .thumbnail-item:hover {
        opacity: 0.7;
    }
    .thumbnail-item img.active {
        border: 2px solid #007bff;
    }
</style>

<script>
function addToCart(productId, csrfToken) {
    fetch(`/cart/add/${productId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            'quantity': 1
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Обновляем счетчик корзины (если есть такой элемент)
            const cartCounter = document.getElementById('cart-counter');
            if (cartCounter) {
                cartCounter.textContent = data.cart_total_items;
            }

            // Показываем уведомление
            const toast = new bootstrap.Toast(document.getElementById('addedToCartToast'));
            toast.show();
        } else {
            alert('Ошибка: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Произошла ошибка при добавлении в корзину');
    });
}
</script>
{% endblock %}